<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>OBS Countdown + Stopwatch</title>
  <style>
    body {
      background: rgba(0, 0, 0, 0);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: 'Courier New', monospace;
    }

    canvas {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      pointer-events: none;
    }

    #countdown-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 80px;
      font-weight: bold;
      color: black;
      z-index: 11;
      pointer-events: none;
    }

    #time {
      font-size: 64px;
      color:  #5c4033; /* ←文字の色 */
      background-color: white; /* ←タイマーの背景色 */
      border: 8px solid  #5c4033;/* ←タイマーの枠線の太さ、枠線の色 */
      border-radius: 20px;
      padding: 20px 40px;
      width: 550px;
      text-align: center;
      box-sizing: border-box;
      z-index: 1;
    }

    .buttons {
      display: flex;
      gap: 20px;
      position: absolute;
      bottom: 50%;
      transform: translate(-50%, 250px); /* ←数字を大きくするとボタンの位置が下がる */
      left: 50%;
      z-index: 12;
    }

    button {
      font-size: 20px;
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background-color: #eeeeee;
      color: #000;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #dddddd;
    }
  </style>
</head>
<body>
  <canvas id="countdown-circle" width="300" height="300"></canvas>
  <div id="countdown-number"></div>
  <div id="time">-00:00:10.00</div>
  <div class="buttons">
    <button onclick="start()">▶️ Start</button>
    <button onclick="pause()">⏸️ Pause</button>
    <button onclick="reset()">🔄 Reset</button>
  </div>

  <script>
    let baseOffset = -10000;
    let startTime = Date.now();
    let elapsed = 0;
    let interval = null;
    let hasStarted = false;
    let isPaused = false;

    const timeDisplay = document.getElementById("time");
    const countdownCanvas = document.getElementById("countdown-circle");
    const ctx = countdownCanvas.getContext("2d");
    const countdownNumber = document.getElementById("countdown-number");

    function formatTime(ms) {
      const isNegative = ms < 0;
      const abs = Math.abs(ms);
      const hrs = String(Math.floor(abs / 3600000)).padStart(2, '0');
      const mins = String(Math.floor((abs % 3600000) / 60000)).padStart(2, '0');
      const secs = String(Math.floor((abs % 60000) / 1000)).padStart(2, '0');
      const centis = String(Math.floor((abs % 1000) / 10)).padStart(2, '0');
      return (isNegative ? '-' : '') + `${hrs}:${mins}:${secs}.${centis}`;
    }

    function drawCountdownCircle(progress) {
      const radius = 140;
      const center = 150;
      ctx.clearRect(0, 0, 300, 300);

      ctx.beginPath();
      ctx.lineWidth = 20;
      ctx.strokeStyle = '#5c4033'; /* ←始まる前の円の色 */
      ctx.arc(center, center, radius, -Math.PI / 2, -Math.PI / 2 + (2 * Math.PI * progress), false);
      ctx.stroke();
    }

    function update() {
      if (isPaused) return;

      const now = Date.now();
      const current = elapsed + (now - startTime) + baseOffset;
      const secondsOnly = current / 1000;

      if (secondsOnly < 0) {
        const progress = Math.min(1, Math.max(0, -secondsOnly / 10));
        drawCountdownCircle(progress);

        let displaySec = Math.ceil(-secondsOnly);
        if (displaySec === 0) displaySec = '';
        if (secondsOnly <= -10 && secondsOnly > -11) displaySec = '10';
        countdownNumber.textContent = displaySec.toString().padStart(2, '0');

        timeDisplay.style.visibility = 'hidden';
      } else {
        if (!hasStarted) {
          ctx.clearRect(0, 0, 300, 300);
          countdownNumber.textContent = '';
          hasStarted = true;
        }
        timeDisplay.style.visibility = 'visible';
      }

      timeDisplay.textContent = formatTime(current);
    }

    function start() {
      if (!interval) {
        startTime = Date.now();
        interval = setInterval(update, 10);
        isPaused = false;
      }
    }

    function pause() {
      if (interval) {
        clearInterval(interval);
        interval = null;
        elapsed += Date.now() - startTime;
        isPaused = true;
      }
    }

    function reset() {
      clearInterval(interval);
      interval = null;
      startTime = Date.now();
      elapsed = 0;
      hasStarted = false;
      isPaused = false;
      update();
    }

    window.onload = () => {
      interval = setInterval(update, 10);
    };
  </script>
</body>
</html>
